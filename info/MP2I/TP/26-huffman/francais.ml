(* En Français, la longueur d'un mot est de 4.8 caractère en moyenne (dans l'usage).
   Ceci signifie que l'espace apparait 1 fois sur 4.8, soit avec une fréquence de 20.83%.
   Les autres lettres ont des fréquences données par https://fr.wikipedia.org/wiki/Fréquence_d'apparition_des_lettres;
   ce sont les fréquences qui ont été utilisées.
   Il faudrait multiplier toutes ces fréquences par 79.16/100 pour prendre en compte les espaces dans les pourcentages.
   De manière équivalente, on multiplie la fréquence des espaces par 100*79.16 pour que les rapports entre "fréquences" restent les mêmes
   avec le moins de modifications possibles. *)
(* Remarque : plein de caractères ont été ignorés, comme les accents et la ponctuation. L'important est seulement le rapport entre les fréquences. *)


let lettres =       [| ' '; 'a'; 'b';   'c';   'd';   'e';  'f';  'g'; 'h';  'i';  'j';  'k';  'l';  'm';  'n';  'o';  'p';  'q';  'r';  's';  't';  'u';  'v';  'w'; 'x';  'y';  'z'|]
let frequences = [| 26.316; 7.11; 1.14; 3.18; 3.67; 12.10; 1.11; 1.23; 1.11; 6.59; 0.34; 0.29; 4.96; 2.62; 6.39; 5.02; 2.49; 0.65; 6.07; 6.51; 5.92; 4.49; 1.11; 0.17; 0.38; 0.46; 0.15|]

let rec construit_couples lettres freq = match (lettres, freq) with
  [],[] -> []
  | [],_ |_,[] -> failwith "longueurs incompatibles"
  | tl::ql, tf::qf -> (tl,tf) :: construit_couples ql qf

let lettres_avec_frequences = construit_couples (Array.to_list lettres) (Array.to_list frequences)
(* la liste lettres_avec_frequences contient les couples (l,f) des lettres de l'alphabet utilisé dans la langue française (sans ponctuation ni accent), i.e.
   [(' ', 26.316); ('a', 7.11); ('b', 1.14); ... ]*)

type arbre_code =
  | F of char
  | N of arbre_code * arbre_code


(* arbre de code pour les fréquences d'apparition dans la langue Française : *)
let arbre_francais = 
 N
  (N (N (N (F 't', F 'r'), F 'e'),
    N (N (F 'n', F 's'),
     N (F 'i',
      N (F 'c',
       N (N (F 'q', N (F 'j', F 'x')),
        N (N (F 'y', N (F 'k', N (F 'z', F 'w'))), F 'f')))))),
  N (F ' ',
   N (N (F 'a', N (F 'd', F 'u')),
    N (N (N (N (F 'h', F 'v'), N (F 'b', F 'g')), F 'l'),
     N (F 'o', N (F 'p', F 'm'))))))


let mystere = "11100011111011011010110110011100010010111110110101111100010001110101101110110011011100111101000111011"
let mystere2 = "0101110011101110110000100010000101111110010001011100110101111101111011011000110111010011011111011110011001010101111100100"
let mystere3 = "111111110001100101101110001111101101101011001011100111000100101111101101010111111111100110100111101000110010000110011100001111100110010110111110110001011001111001101110011011101100111110010110001100000101101000110111001011110010001000011011110110111011010001101111111100110111110001110001100101001100101011000001101111000000011011110010010101011111111110011010100101011010011110100011011010001111000111000110010110000100101011101111111100100011011111111001011100010110001101100110110111101011110110110001110101011100001101101101011001110001001011101011100011111011011010110100111101000110110100110000111000110010110011110011011001100111010001010100001011010101100111001011110000111010101101000101011000010010100011101111001000000000100101011010101101000101011011100110010100010110011110011011011010111111101111001000000100000001010011010110111011101110010111111110001100100101011111000111011000010001000000010011011001011011010010111111111101111110010100000010111101101110011110100011001000011011111011110110111110001110001100101101111101100010110101111011011100111101010001000011000110010110010100111011111011001110111000000101111101101011111111110011010101010001000010011101000101010000101100010101010010111110110100111011011000101100011101101111011101101000110010100110110100110000100110011110011011001101110100101011011100001100010111000001110100101101011101001010110000100101000111011110010000000001001010110011111111110000111100110010100000010110110100001101101000101010000011001000010011010101011111011000001011100011001111001101100110011110011011110001001101010111100100101100101110100110111001111110110110000101101000110111011100100111011100001111001010011010011110011011110001001101010111100100101100101110100110111001111110110110000101101000110111011100100111011100001111001010011011100100110001010010011111111000110000000110101110100110111001000111001101110111001100101010000001101011111011000001011111111110011001011011110010010010000110000000011111011011111000100110111110110001011011101100110010000000010001111011111001110110110000001110110001100010100100111111110001110001101001111010001101101001100001110001100101101011101001101111110110000111110011000011001111001101101101011100011111011011010110110001101101000110110010110011100011100010001110001000110101011001110111110000101011001110001100100100010101000010111110110001011011111111110010010011101100010110100111011110111111111111001100111101000110111010011011010011001011100011001011011101110010101111101101101100101011110011011001101111111111001101011001101110011101111001000000000111000110000100110100111101010110001101011111011011101010001000010011110100011011010011001011011111100100010111001101011001011101110010111000101100011010011110100011011101110110110101101001100101101111110010001011100110101001111010001100111011100001100010000000011011101110010111000101100011010011110100011011010110001000101001101110111001011100010110001101010100111101000110010000110010111011011001011001111001101110110011111111110110110001101010101000100001001111110110010011001110100111111100101000000101001111001101111000100110101011100100011100110110111011110110111111101011010001101110011001010001011011001101101111010111101101100011101010111000011011011010111111001101101001100101001010000001010101010111111110001100101100111011110111111111111001010000001001111111100011001011000001101110111110111101101100011011001110001111100110000110011100010000000000110111000011011111111110001000110000000110101010001111000010111001001100010100100111101000110111010011101100011000010011111101111001001101001011000000001001010110010101101111111111101110100111111100101000000101001111010001101110100111011000110110100110010110011110011011001100111010001010100001001110001101110011111101101100001011010001101110110110011111111110110110001101001110001101110011111101101100001011010111100100011101001111001101101101011111110110010111110111101101101010101001101100110110111101011110110110001110101011100001101101101011001000101000000000100111111000010010100110100001001101101101000011001110111100100010100000001110110111000000110111100100101111110010111011000100011001111001101100110101111111100011001011011010001111111110001100100101001111001101101101001011100011000001010111110001110110000100010000000100110010101101111111111101110100111111100101000000101100101111110011011111100100000000000100110110011011100101001000111100010110011100011011010001101110111001001110111101111111111111101101001100110110000001101011001001111111100011000010011011101001101101011110010010101110100110110101111001001011010001100101111100110"




(* --- Affichage progressif d'un qui ressemble beaucoup à celui de utop : --- *)
(* pour aider vos tests *)
let rec taille arbre = match arbre with
  F c -> 0
  | N(a,b) -> (taille a) + (taille b) + 1

let affiche_arbre a =
  let rec affiche_arbre_aux dec a b = match a with
    |F(c) -> if b then print_string (String.make dec ' ');
      Printf.printf "F '%c'" c
    |N(a1,a2) -> let t1 = taille a1 in
      let t2 = taille a2 in
      if t1 >= 4 then begin
        if b then print_string (String.make dec ' ');
        Printf.printf "N \n";
        print_string (String.make (dec+1) ' '); print_string "(";
        affiche_arbre_aux (dec+2) a1 false;
        print_string ",\n";
        affiche_arbre_aux (dec + 2) a2 true;
        print_string ")" end
      else begin
        if t2 >= 3 then begin
          if b then  print_string (String.make dec ' ');
          Printf.printf "N (";
          affiche_arbre_aux (dec + 1) a1 false;
          print_string ",\n";
          affiche_arbre_aux (dec+1) a2 true;
          print_string ")"
        end
        else begin
          if b then print_string (String.make dec ' ');
          Printf.printf "N (";
          affiche_arbre_aux (dec+1) a1 false;
          print_string ", ";
          affiche_arbre_aux (dec+1) a2 false;
          print_string ")"
        end
      end
  in affiche_arbre_aux 0 a true

